<!DOCTYPE html>
<html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<body onload="getData()">
    <div id = "user"></div>
    <script type="text/javascript">
        function getData() {
            sessionid = getCookie("sessionid");
            userid = getCookie("userid");
            if (sessionid === null || userid === null) {
                alert("Your session expired please login again")
                window.location = "http://127.0.0.1:5000";
                return;
            } else {
                console.log("sessionid = " + sessionid);
                console.log("userid = " + userid);
            }
            url = "http://127.0.0.1:5000/userservice/api/v1.0/user"
            var xhr = new XMLHttpRequest();
            xhr.open("GET", url, true);
            xhr.setRequestHeader('Content-type','application/json; charset=utf-8');
            xhr.setRequestHeader('sessionid',sessionid);
            xhr.setRequestHeader('userid',userid);
            xhr.onload = function () {
                if (xhr.readyState == 4 && xhr.status == "200") {
                    var users = JSON.parse(xhr.responseText);
                    // render page here to display images
                    // hit analytics endpoint to get images
                    $("#user").val(xhr.responseText);
                    console.log(users)
                } else {
                    alert("Your session expired please login again")
                    window.location = "http://127.0.0.1:5000";
                    return;
                }
            }
            xhr.send();
        }

        function getCookie(name) {
          if (document.cookie == 0) return null;
          var cookieItems = document.cookie.split(";")
          var dictionary = {};
          for (i = 0; i < cookieItems.length; i++) {
            cookieItems[i] = cookieItems[i].split("=");
            dictionary[cookieItems[i][0].trim()] = cookieItems[i][1].trim();
        }
        if (!(name in dictionary)) {
            return null;
        }
        return dictionary[name];
    }
</script>
</body>
</html>
